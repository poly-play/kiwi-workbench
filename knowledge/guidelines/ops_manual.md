# 🥝 Kiwi 运营操作手册 (Ops Manual)

欢迎使用 Kiwi 工作台！
这是专为 iGaming 运营团队打造的智能化助手。你不需要写代码，甚至不需要懂什么是 Python，只需要会简单的配置，或者直接告诉 AI 你想做什么，Kiwi 就能帮你搞定。

---

## 💻 第 0 步：环境准备 (One-Click Setup)

要想让 Kiwi 跑起来，你只需要做一件事：

1.  打开终端 (Terminal)。
2.  进入本项目目录。
3.  运行下面这行命令：

```bash
sh scripts/setup.sh
```

脚本会自动检测 Python，安装 `uv`，并初始化环境。
如果看到 **"Kiwi Workbench is READY!"**，恭喜你，准备工作完成！

## 🧠 第 0.5 步：配置大脑 (Configure Brain)

Kiwi 需要一个 "大脑" 才能思考。你需要去申请一个 Google Gemini 的密钥。

*   👉 **点击查看教程**: **[如何获取 Gemini API Key](gemini_setup.md)**
*   👉 **点击查看教程**: **[如何管理 Telegram 账号矩阵](telegram_account_management.md)**

拿到 Key 后，打开项目里的 `.env` 文件，粘贴进去即可。

---

## 🚀 核心概念 (一分钟入门)

## 🚀 核心概念 (一分钟入门)

> **🌟 黄金法则 (The Golden Rule)**
> Kiwi 的大脑存储在 `README.md` 中。为了让 AI 最懂你的业务，建议在 **Customizations** 中配置，或在开启复杂对话时提醒：
> **"Read @README.md to understand the latest project context."**

在使用 Kiwi 之前，只需要理解这 3 个词：

1.  **业务域 (Domain)**: 你在做什么事？
    *   `operations`: 搞活动、发奖、管 VIP。
    *   `marketing`: 投广告、管素材。
    *   `risk`: 查风控、审提现。
2.  **App (应用)**: 你在管哪个包？
    *   例如 `jeetup` (印度包), `winner777` (巴西包)。
    *   Kiwi 严格区分每个 App 的数据，绝对不会弄混。
3.  **Prompt (指令)**: 你怎么指挥 AI？
    *   就像和同事说话一样：“帮我把 JeetUp 的日报跑一下。”
4.  **Skill (技能)**: AI 会什么手艺？
    *   AI 不是万能的，但它学了很多“技能”，比如“写代码”、“存素材”、“查百科”。
    *   你可以问它：“你会做什么技能？”

    *   你可以问它：“你会做什么技能？”

---

## 🏗️ 进阶：我该用哪个？ (Concept Pyramid)

很多同学分不清 **Script (脚本)**, **Skill (技能)** 和 **Workflow (工作流)** 的区别。
这里有一个简单的**决策金字塔**：

| 层级 | 概念 (Concept) | 比喻 (Analogy) | 定义 | 什么时候用？ |
| :--- | :--- | :--- | :--- | :--- |
| **顶层 (Process)** | **Workflow** | **SOP 手册** | 把一堆事串起来，按步骤做完。 | 想要**按部就班**完成一套复杂工作时（如：每日巡检）。 |
| **中层 (Tool)** | **Skill** | **工具箱** | Agent 自带的能力，用来创造或管理资源。 | 想要**创造**新脚本、**管理**文件、或者**查询**知识时。 |
| **底层 (Action)** | **Script** | **APP** | 一个具体的功能程序，干完就走。 | 想要完成一个**具体业务动作**时（如：发奖、查数）。 |

> **总结**: Workflow 调用 Skill，Skill 生成或管理 Script。

---

## 🛠️ 场景一：我想每天收一份报表 (Zero Code)

如果你懂一点 SQL，或者能让 AI 帮你写 SQL，你就可以在 1 分钟内配置一个自动报警。

### 步骤
1.  **告诉 AI**: "我想加一个监控，如果 1 小时内有超过 1 万的提现，就发飞书报警。"
2.  **AI 会做什么**:
    *   它会在 `knowledge/reports/` 下新建一个 YAML 文件。
    *   它会写好 SQL。
    *   它会配置好飞书机器人。
3.  **你需要做什么**: **Review 一下**。
    *   看看 SQL 对不对？
    *   看看报警文案满不满意？

### 配置文件长什么样？
如果不放心，你可以自己看一眼生成的 YAML 配置（非常简单）：
```yaml
title: "大额提现监控"
sql: "SELECT * FROM withdrawals WHERE amount > 10000"
trigger_rule: "len(df) > 0"  # 如果查出来的行数大于0，就报警
message: "🚨 发现 {count} 笔大额提现，请立即处理！"
```
就这么简单！

---

## 🔧 场景二：我想用 AI 的工具 (Using Skills)

Kiwi 内置了很多强大的工具（Skills），你不需要知道它们的代码在哪里，只需要“呼唤”它们。

### 例子 1：我要发素材
*   **指令**: "把这个 banner.jpg 分发到 JeetUp 的素材库。"
*   **AI 行为**: 自动调用 `asset_manager` 技能，处理去重、存储、CDN 上传。

### 例子 2：我要做新功能 (代码生成)
*   **指令**: "我要做一个 operations 下的活动脚本，叫 `weekly_cashback`，逻辑是......"
*   **AI 行为**: 自动调用 `scaffold_new_script` 技能，帮你生成标准代码框架。
    *   *注：这就是所谓的 Low Code 模式，AI 帮你写了 80% 的代码。*

---

## ⏰ 场景三：我想把任务定下来 (Scheduler)

脚本写好了，你想让它每天自动跑，不用每次都去吼 AI。

### 步骤
1.  **告诉 AI**: "把刚才那个 `weekly_cashback` 设为每周五上午 10 点执行，JeetUp 和 Winner 这两个包都要跑。"
2.  **AI 会做什么**:
    *   它会修改 `knowledge/scheduler.yaml` (日程表)。
    *   它会告诉你：“已设定，下次运行时间是本周五 10:00。”

---

## 📂 场景四：我的文件去哪了？ (Outputs)

所有 Kiwi 跑出来的结果（CSV, 对账单, 报表），都会整整齐齐地放在这里：

`data/outputs/{业务}/{App}/{月份}/...`

*   比如 JeetUp 1月份的活动数据：
    `data/outputs/operations/activity/jeetup/2026-01/`

你可以直接在文件夹里找，或者让 AI：“把 JeetUp 昨天的发奖名单发给我。”

---

## 🔗 场景五：复杂的套路 (Workflows)

有些工作不是跑一个脚本就能搞定的，比如“每日早安巡检”，你可能需要：
1.  先跑数据监控，看昨晚有没有挂。
2.  再查大额提现，看有没有积压。
3.  最后清理一下素材收件箱。

这时候，你需要 **Workflow (工作流)**。

### 怎么用？
1.  **告诉 AI**: "我每天早上都要做这三件事（列出），你帮我存成一个 Workflow，叫 `daily_health_check`。"
2.  **下次使用**:
    *   **指令**: "执行每日巡检。"
    *   **AI 行为**: 它会像一个老练的助理，拿出小本本（SOP），一项一项地帮你做完，最后给你一个汇总报告。

### 为什么要用 Workflow？
*   **防呆**: 即使是新手，照着 Workflow 跑也不会漏步骤。
*   **沉淀**: 把你脑子里的“经验”变成了团队共享的“资产”。

---

## 💡 给 AI 的指令模版 (Cheat Sheet)

| 你想做什么 | 你可以这样说 | 背后的原理 |
| :--- | :--- | :--- |
| **查数据** | "查一下 JeetUp 昨天充值排名前 10 的用户。" | AI 写 SQL -> Connector |
| **加监控** | "加一个风控规则，同 IP 注册超过 5 个账号就报警。" | **Zero Code** (Generic Reporter) |
| **用工具** | "帮我把 Inbox 里的素材整理一下。" | **Skill** (Asset Manager) |
| **写脚本** | "写个脚本，每周五给亏损用户发 10% 返利。" | **Skill** (Scaffolder) |
| **定日程** | "这个返利脚本，以后每周五 10 点自动跑。" | **Scheduler** (GitOps) |
| **跑流程** | "执行每日早安巡检。" | **Workflow** (SOP Engine) |
| **做分析** | "分析一下为什么昨天 NGR 跌了？" | **AI Lab** (Exploration) |

---

## 🧠 场景六：让 AI 帮我优化策略 (AI Lab)

除了干活，Kiwi 还能帮你**出主意**。特别是在风控和活动发奖上，它能通过数据分析来优化规则。

### 步骤
1.  **提出问题**: "我觉得现在的风控太松了，帮我分析一下上周的红利套利情况，看看能不能优化一下规则？"
2.  **AI 会做什么 (进入 Lab 模式)**:
    *   它会在 `workspace/` 里写代码，把上周的数据拉出来。
    *   它会尝试寻找“坏人”的共同特征（比如 IP、设备号、充值时间）。
    *   它会告诉你：“如果把单日充值 > 5000 且 投注倍数 < 2 的人标记为高危，能多抓 50 个坏人，误伤 1 个好人。”
3.  **你需要做什么**:
    *   **拍板**。如果你觉得这个建议靠谱，就说：“好，就把这条规则加到配置里去。”
    *   AI 就会去更新 `config.yaml`，新的风控策略立即生效。

---

**记住**：Kiwi 是你的**智能助手**，不是冷冰冰的机器。遇到不会的，直接问它：“这该怎么弄？”就好了！
